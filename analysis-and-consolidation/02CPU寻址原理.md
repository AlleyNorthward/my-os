# 简介
看了看视频, 发现`cpu`内部的寄存器是很有限的, 而且, 一个寄存器只能存一个值. 那么, 我们写的程序, 这么长, 就那几个寄存器, 怎么可能够用呢? 所以说, `cpu`数据存储的本质原理是什么呢? 带着这些疑问, 问了问`ai`, 发现, 十分有意思. 这些东西, 或许在计算机组成原理中已经讲过了, 但当时根本没有硬件层面的理解, 所以根本就不会去听. 现在有了硬件的理解, 再去看这些内容, 也太简单了(是吗? 哈哈哈). 所以, 下面再来分析一下`cpu`寻址的原理吧.  

- `x86 32`位模式下, `cpu`有`8`个通用寄存器.
| 寄存器   | 主要用途                       |
| ----- | -------------------------- |
| `EAX` | 累加寄存器，常用于算术运算或函数返回值        |
| `EBX` | 基址寄存器，常用于存储内存基地址           |
| `ECX` | 计数寄存器，常用于循环计数或字符串操作        |
| `EDX` | 数据寄存器，I/O 操作或乘除法扩展         |
| `ESI` | 源索引寄存器，通常指向源内存地址（字符串/数组操作） |
| `EDI` | 目的索引寄存器，通常指向目标内存地址         |
| `EBP` | 基址指针，常用作栈帧基址               |
| `ESP` | 栈指针，指向当前栈顶                 |
- 由于历史原因, 前四个寄存器中, 低十六位, 其中的低八位和高八位, 都有另一个名字, 知道就行, 我们现在就用上面这八个寄存器表示.
- `cpu`还有`6`而过段寄存器.
| 寄存器  | 作用                           |
| ---- | ---------------------------- |
| `CS` | Code Segment，指向代码段（指令所在的内存段） |
| `DS` | Data Segment，默认数据段（变量、数组等）   |
| `SS` | Stack Segment，指向栈段           |
| `ES` | Extra Segment，可用于额外数据段       |
| `FS` | 扩展段，常用于操作系统或线程局部存储           |
| `GS` | 扩展段，同 FS，一般用于特殊用途            |
- 段寄存器内, 存的是**内存段的基地址**, 也就是段在内存中的起始位置. 访问内存时, `cpu`会用段寄存器+偏移量计算实际物理地址.
- 寄存器一次只能存储一个值, 但这个值可以是
    - 一个整数(`32`位内的任意数)
    - 一个指针(内存地址)
    - 某种二进制编码数据
- 换句话说, 寄存器里就是一个固定大小的存储单元.
~~~asm
mov eax, 5      ; EAX = 5
mov eax, 10     ; EAX 会被覆盖，EAX = 10
~~~
- 如上, 后面重复赋值, 会覆盖之前的数据`5`, 所以一个寄存器一次只能存储一个值, 想存第二个数据, 需要另一个寄存器或者内存位置.
- 寄存器不够用怎么办? `cpu`寄存器非常少, 数据量通常远大于寄存器容量, 所以, 计算机会使用**内存**+**寄存器结合**来存储数据.
    - 寄存器, 小/快,存放`cpu`正在使用的关键数据或指针.只存放一小部分数据(临时变量/循环计数器等)
    - 内存(RAM) 大/慢, 存放大量数据, `cpu`通过寄存器中的地址/偏移访问.
- 上面也说了, 部分通用寄存器, 也可以通过高八位, 低八位, 低十六位等的操作方式, 拓展同一寄存器使用方式.
- 我们昨天说的栈, 堆, 代码区, 数据区, 不就是一个个的`cpu`寻址的地方吗? 我们无法将所有程序都放入`cpu`中, 但是, 通过段寄存器的偏移寻址, 就很容易地找到内存中存储它们的地方. 所以, 对于栈而言, 不是抽象概念, 是真实存在的. 
- 段寄存器的寻址, 上面的本质其实没有说到. 
    - 对于该计算机, 只有`20`根寻址总线, 所以内存可寻址范围为`2^20`, 也就是`1MB`. 而段寄存器只有`16`位, 所以, 该寄存器寻址范围只能有`2^16`, 无法满足需求. 那么怎么办呢? 
    - 所以只能再增添寄存器(偏移寄存器), 来解决该实际问题. 
    - 对于寻址范围, 只是相差了`2^4`, 也就是一位寄存器. 实际解决方式是, 段寄存器左移四位, 空出一位来(`16`进制的一位), 然后加上偏移寄存器的值即可. 这样就能寻址`2^20`了(也就是`5`位十六进制数)
    - 为了寻址(真实的物理地址), 段寄存器和偏移寄存器必须共同使用.




